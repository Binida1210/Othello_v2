<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Othello Classic</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --main-bg: #2e7d32;
      --panel-bg: #fff;
      --primary: #1976d2;
      --primary-dark: #115293;
      --border: #222;
      --cell-bg: #388e3c;
      --cell-hover: #43a047;
      --cell-dark: #2e7d32;
      --shadow: 0 4px 24px #0003;
      --radius: 12px;
      --transition: 0.18s cubic-bezier(.4,0,.2,1);
    }
    body {
      background: var(--main-bg);
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      justify-content: center;
      padding: 24px 0;
    }
    .settings, .game {
      background: var(--panel-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 36px 44px 32px 44px;
      margin: 32px 0;
      min-width: 340px;
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: fadeIn .5s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(40px);}
      to { opacity: 1; transform: none;}
    }
    .settings h1 {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--primary-dark);
      margin-bottom: 18px;
      letter-spacing: 2px;
      text-shadow: 0 2px 8px #1976d244;
    }
    .settings label, .settings span {
      font-size: 1.15rem;
      margin-right: 12px;
      color: #333;
    }
    .settings input[type=range] {
      width: 140px;
      accent-color: var(--primary);
      margin: 0 8px;
    }
    .settings .row {
      margin: 18px 0;
      display: flex;
      align-items: center;
      width: 100%;
      justify-content: center;
    }
    .settings .first-btns button {
      font-size: 1.1rem;
      border-radius: 8px;
      padding: 8px 22px;
      margin: 0 8px;
      border: 2px solid #bdbdbd;
      background: #f7fafd;
      color: #222;
      cursor: pointer;
      transition: background var(--transition), color var(--transition), border var(--transition);
      font-weight: 500;
      box-shadow: 0 1px 4px #0001;
    }
    .settings .first-btns button.selected,
    .settings .first-btns button:hover {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
    }
    .settings .ok-cancel button {
      font-size: 1.1rem;
      border-radius: 8px;
      padding: 8px 36px;
      margin: 0 16px;
      border: none;
      background: var(--primary);
      color: #fff;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 2px 8px #1976d233;
      transition: background var(--transition), transform var(--transition);
    }
    .settings .ok-cancel button:hover {
      background: var(--primary-dark);
      transform: translateY(-2px) scale(1.04);
    }
    .game-area {
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      margin-bottom: 24px;
      gap: 48px;
    }
    .board {
      display: grid;
      background: #1b5e20;
      border-radius: 8px;
      margin-right: 0;
      box-shadow: 0 2px 16px #0005;
      padding: 10px;
      border: 6px solid #111;
      transition: box-shadow var(--transition);
    }
    .cell {
      width: 52px;
      height: 52px;
      background: linear-gradient(135deg, var(--cell-bg) 70%, var(--cell-dark) 100%);
      outline: 1.5px solid #222;
      outline-offset: -1.5px;
      border: none;
      border-radius: 0;
      box-shadow: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      transition: background var(--transition);
    }
    .cell:hover {
      background: var(--cell-hover);
      z-index: 2;
      box-shadow: 0 4px 16px #0004;
    }
    .disc {
      border-radius: 50%;
      width: 38px;
      height: 38px;
      box-shadow: 0 2px 8px #0005, 0 0 0 2px #333;
      transition: box-shadow var(--transition), border var(--transition);
      position: relative;
    }
    .disc.black {
      background: radial-gradient(circle at 60% 35%, #444 60%, #111 100%);
      border: 2px solid #222;
    }
    .disc.white {
      background: radial-gradient(circle at 60% 35%, #fff 70%, #bbb 100%);
      border: 2px solid #eee;
    }
    .block-square {
      width: 38px;
      height: 38px;
      background: repeating-linear-gradient(
        135deg, #1565c0, #1976d2 8px, #1565c0 16px
      );
      border-radius: 5px;
      border: 2px solid #111;
      box-shadow: 0 2px 8px #0005;
    }
    .highlight {
      outline: 3px solid #ffeb3b;
      z-index: 2;
      box-shadow: 0 0 22px 2px #fff17699;
    }
    .last-move {
      position: relative;
    }
    .last-move .disc::after {
      content: "";
      position: absolute;
      left: -6px;
      top: -6px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: 4px solid #1976d2; /* màu block */
      pointer-events: none;
      box-sizing: border-box;
      z-index: 10;
    }
    .scoreboard {
      font-size: 1.7rem;
      font-weight: bold;
      margin-bottom: 24px;
      min-width: 180px;
      color: #222;
      background: #f7fafd;
      border-radius: 10px;
      padding: 16px 24px;
      text-align: center;
      box-shadow: 0 1px 4px #0001;
      letter-spacing: 1px;
    }
    .turn {
      font-size: 1.7rem;
      font-weight: bold;
      margin-bottom: 12px;
      color: var(--primary-dark);
      text-align: center;
      letter-spacing: 1px;
      text-shadow: 0 2px 8px #1976d244;
    }
    .menu-btn {
      background: var(--primary-dark);
      color: #fff;
      border-radius: 14px;
      font-size: 1.2rem;
      padding: 13px 44px;
      border: none;
      margin-top: 24px;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 2px 8px #1976d233;
      transition: background var(--transition), transform var(--transition);
    }
    .menu-btn:hover {
      background: var(--primary);
      transform: translateY(-2px) scale(1.04);
    }
    @media (max-width: 900px) {
      .game-area { flex-direction: column; align-items: center; gap: 24px;}
      .board { margin-right: 0; margin-bottom: 24px; }
    }
    @media (max-width: 600px) {
      .settings, .game { min-width: 0; width: 98vw; padding: 18px 2vw 18px 2vw;}
      .scoreboard, .turn { font-size: 1.2rem;}
      .board { padding: 4px;}
      .cell { width: 32px; height: 32px;}
      .disc, .block-square { width: 20px; height: 20px;}
    }
  </style>
</head>
<body>
<div class="container">
  <div class="settings" id="settings">
    <h1>Othello</h1>
    <div class="row">
      <label for="boardSize">Board Size:</label>
      <input type="range" id="boardSize" min="6" max="12" step="2" value="8">
      <span id="boardSizeVal">8</span>
    </div>
    <div class="row">
      <label for="blockCount">Blocks:</label>
      <input type="range" id="blockCount" min="0" max="16" value="0">
      <span id="blockCountVal">0</span>
    </div>
    <div class="row first-btns">
      <button id="blackFirst" class="selected">Black First</button>
      <button id="whiteFirst">White First</button>
      <button id="randomFirst">Random First</button>
    </div>
    <div class="row ok-cancel">
      <button id="okBtn">OK</button>
      <button id="cancelBtn">Cancel</button>
    </div>
  </div>
  <div class="game" id="game" style="display:none;">
    <div class="game-area">
      <div class="board" id="board"></div>
      <div>
        <div class="turn" id="turn"></div>
        <div class="scoreboard" id="score"></div>
      </div>
    </div>
    <button class="menu-btn" id="backMenuBtn">Back to Menu</button>
  </div>
</div>
<script>
  // ==== GAME STATE ====
  let boardSize = 8;
  let blockCount = 0;
  let board = [];
  let currentPlayer = 1; // 1: Black, 2: White
  let settingFirst = 1;
  let lastMove = null;

  // ==== SETTINGS UI ====
  const settings = document.getElementById('settings');
  const game = document.getElementById('game');
  const boardSizeInput = document.getElementById('boardSize');
  const boardSizeVal = document.getElementById('boardSizeVal');
  const blockCountInput = document.getElementById('blockCount');
  const blockCountVal = document.getElementById('blockCountVal');
  const blackFirstBtn = document.getElementById('blackFirst');
  const whiteFirstBtn = document.getElementById('whiteFirst');
  const randomFirstBtn = document.getElementById('randomFirst');
  const okBtn = document.getElementById('okBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const backMenuBtn = document.getElementById('backMenuBtn');

  boardSizeInput.oninput = function() {
    let v = parseInt(this.value);
    if (v % 2 !== 0) v += 1;
    this.value = v;
    boardSizeVal.textContent = v;
    blockCountInput.max = Math.floor(v*v/2 - 4);
    if (parseInt(blockCountInput.value) > blockCountInput.max) {
      blockCountInput.value = blockCountInput.max;
      blockCountVal.textContent = blockCountInput.max;
    }
  };
  blockCountInput.oninput = function() {
    blockCountVal.textContent = this.value;
  };
  blackFirstBtn.onclick = function() {
    blackFirstBtn.classList.add('selected');
    whiteFirstBtn.classList.remove('selected');
    randomFirstBtn.classList.remove('selected');
    settingFirst = 1;
  };
  whiteFirstBtn.onclick = function() {
    blackFirstBtn.classList.remove('selected');
    whiteFirstBtn.classList.add('selected');
    randomFirstBtn.classList.remove('selected');
    settingFirst = 2;
  };
  randomFirstBtn.onclick = function() {
    blackFirstBtn.classList.remove('selected');
    whiteFirstBtn.classList.remove('selected');
    randomFirstBtn.classList.add('selected');
    settingFirst = Math.random() < 0.5 ? 1 : 2;
  };
  okBtn.onclick = function() {
    boardSize = parseInt(boardSizeInput.value);
    blockCount = parseInt(blockCountInput.value);
    currentPlayer = settingFirst;
    startGame();
    settings.style.display = 'none';
    game.style.display = '';
  };
  cancelBtn.onclick = function() {
    window.close();
  };
  backMenuBtn.onclick = function() {
    game.style.display = 'none';
    settings.style.display = '';
  };

  // ==== GAME LOGIC ====
  function startGame() {
    // Khởi tạo board
    board = [];
    for (let r = 0; r < boardSize; ++r) {
      board[r] = [];
      for (let c = 0; c < boardSize; ++c) board[r][c] = 0;
    }
    // Đặt 4 quân giữa
    let mid = boardSize / 2;
    board[mid-1][mid-1] = 2;
    board[mid][mid] = 2;
    board[mid-1][mid] = 1;
    board[mid][mid-1] = 1;
    // Đặt block
    let used = new Set([`${mid-1},${mid-1}`,`${mid},${mid}`,`${mid-1},${mid}`,`${mid},${mid-1}`]);
    let placed = 0;
    while (placed < blockCount) {
      let r = Math.floor(Math.random()*boardSize);
      let c = Math.floor(Math.random()*boardSize);
      if (board[r][c] === 0 && !used.has(`${r},${c}`)) {
        board[r][c] = 3;
        used.add(`${r},${c}`);
        placed++;
      }
    }
    lastMove = null;
    renderBoard();
    updateInfo();
  }

  function renderBoard() {
    const boardDiv = document.getElementById('board');
    boardDiv.innerHTML = '';
    boardDiv.style.gridTemplateRows = `repeat(${boardSize}, 1fr)`;
    boardDiv.style.gridTemplateColumns = `repeat(${boardSize}, 1fr)`;
    for (let r = 0; r < boardSize; ++r) {
      for (let c = 0; c < boardSize; ++c) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        if (isValidMove(r, c, currentPlayer)) cell.classList.add('highlight');
        if (lastMove && lastMove[0] === r && lastMove[1] === c) cell.classList.add('last-move');
        if (board[r][c] === 1) {
          const disc = document.createElement('div');
          disc.className = 'disc black';
          cell.appendChild(disc);
        } else if (board[r][c] === 2) {
          const disc = document.createElement('div');
          disc.className = 'disc white';
          cell.appendChild(disc);
        } else if (board[r][c] === 3) {
          const block = document.createElement('div');
          block.className = 'block-square';
          cell.appendChild(block);
        }
        cell.onclick = function() {
          if (isValidMove(r, c, currentPlayer)) {
            makeMove(r, c, currentPlayer);
            lastMove = [r, c];
            renderBoard();
            updateInfo();
            setTimeout(checkGameOver, 100);
          }
        };
        boardDiv.appendChild(cell);
      }
    }
  }

  function isValidMove(row, col, player) {
    if (board[row][col] !== 0) return false;
    let opponent = player === 1 ? 2 : 1;
    let dr = [-1,-1,-1,0,0,1,1,1], dc = [-1,0,1,-1,1,-1,0,1];
    for (let d = 0; d < 8; ++d) {
      let r = row + dr[d], c = col + dc[d], cnt = 0;
      while (r >= 0 && r < boardSize && c >= 0 && c < boardSize && board[r][c] === opponent) {
        r += dr[d]; c += dc[d]; ++cnt;
      }
      if (cnt > 0 && r >= 0 && r < boardSize && c >= 0 && c < boardSize && board[r][c] === player) {
        // Kiểm tra có block không
        let rr = row + dr[d], cc = col + dc[d], blockFound = false;
        for (let i = 0; i < cnt; ++i) {
          if (board[rr][cc] === 3) { blockFound = true; break; }
          rr += dr[d]; cc += dc[d];
        }
        if (!blockFound) return true;
      }
    }
    return false;
  }

  function makeMove(row, col, player) {
    board[row][col] = player;
    flipDiscs(row, col, player);
    currentPlayer = (currentPlayer === 1 ? 2 : 1);
    if (!hasValidMove(currentPlayer)) {
      currentPlayer = (currentPlayer === 1 ? 2 : 1);
      if (!hasValidMove(currentPlayer)) {
        setTimeout(showGameOver, 200);
      }
    }
  }

  function flipDiscs(row, col, player) {
    let opponent = player === 1 ? 2 : 1;
    let dr = [-1,-1,-1,0,0,1,1,1], dc = [-1,0,1,-1,1,-1,0,1];
    for (let d = 0; d < 8; ++d) {
      let r = row + dr[d], c = col + dc[d], cnt = 0;
      while (r >= 0 && r < boardSize && c >= 0 && c < boardSize && board[r][c] === opponent) {
        r += dr[d]; c += dc[d]; ++cnt;
      }
      if (cnt > 0 && r >= 0 && r < boardSize && c >= 0 && c < boardSize && board[r][c] === player) {
        let rr = row + dr[d], cc = col + dc[d];
        for (let i = 0; i < cnt; ++i) {
          board[rr][cc] = player;
          rr += dr[d]; cc += dc[d];
        }
      }
    }
  }

  function hasValidMove(player) {
    for (let r = 0; r < boardSize; ++r)
      for (let c = 0; c < boardSize; ++c)
        if (isValidMove(r, c, player)) return true;
    return false;
  }

  function countDiscs(player) {
    let cnt = 0;
    for (let r = 0; r < boardSize; ++r)
      for (let c = 0; c < boardSize; ++c)
        if (board[r][c] === player) ++cnt;
    return cnt;
  }

  function updateInfo() {
    document.getElementById('turn').textContent = "Turn: " + (currentPlayer === 1 ? "Black" : "White");
    document.getElementById('score').innerHTML =
      "Black: " + countDiscs(1) + "<br>White: " + countDiscs(2);
  }

  function showGameOver() {
    let black = countDiscs(1), white = countDiscs(2);
    let msg = black > white ? "Black wins!" : (white > black ? "White wins!" : "Draw!");
    if (confirm(`Black: ${black}\nWhite: ${white}\n${msg}\n\nNew Game?`)) {
      game.style.display = 'none';
      settings.style.display = '';
    }
  }

  function checkGameOver() {
    if (!hasValidMove(1) && !hasValidMove(2)) showGameOver();
  }
</script>
</body>
</html>